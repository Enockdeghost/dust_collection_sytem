{% extends "base.html" %}

{% block title %}Manage Campaigns - DustAid{% endblock %}

{% block content %}
<div class="container py-5">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1>Campaigns</h1>
        <a href="{{ url_for('new_campaign_page') }}" class="btn btn-success">+ New Campaign</a>
    </div>

    <div class="table-responsive">
        <table class="table table-striped">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Name</th>
                    <th>Target</th>
                    <th>Collected</th>
                    <th>Progress</th>
                    <th>Start</th>
                    <th>End</th>
                    <th>Status</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for campaign in campaigns %}
                <tr>
                    <td>{{ campaign.id }}</td>
                    <td>{{ campaign.name }}</td>
                    <td>${{ "%.2f"|format(campaign.target_amount) }}</td>
                    <td>${{ "%.2f"|format(campaign.collected_amount) }}</td>
                    <td>
                        <div class="progress" style="height: 5px; width: 100px;">
                            <div class="progress-bar bg-success" style="width: {{ (campaign.collected_amount / campaign.target_amount * 100) if campaign.target_amount > 0 else 0 }}%;"></div>
                        </div>
                    </td>
                    <td>{{ campaign.start_date.strftime('%Y-%m-%d') }}</td>
                    <td>{{ campaign.end_date.strftime('%Y-%m-%d') }}</td>
                    <td>
                        <span class="badge bg-{{ 'success' if campaign.is_active else 'secondary' }}">
                            {{ 'Active' if campaign.is_active else 'Inactive' }}
                        </span>
                    </td>
                    <td>
                        <a href="{{ url_for('campaign_detail', campaign_id=campaign.id) }}" class="btn btn-sm btn-info">View</a>
                        <button class="btn btn-sm btn-warning" onclick="editCampaign({{ campaign.id }})">Edit</button>
                        <button class="btn btn-sm btn-danger" onclick="deleteCampaign({{ campaign.id }})">Delete</button>
                    </td>
                </tr>
                {% else %}
                <tr>
                    <td colspan="9" class="text-center">No campaigns found.</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<script>
    function editCampaign(id) {
        // Redirect to edit page (we don't have a separate edit template, could use new_campaign with data)
        window.location.href = `{{ url_for('new_campaign_page') }}?id=${id}`;
    }

    function deleteCampaign(id) {
        if (confirm('Are you sure you want to delete this campaign?')) {
            fetch(`/api/campaigns/${id}`, { method: 'DELETE' })
                .then(response => response.json())
                .then(data => {
                    alert(data.message || 'Deleted');
                    location.reload();
                })
                .catch(() => alert('Error deleting campaign'));
        }
    }
</script>
{% endblock %}